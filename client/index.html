<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  <div>
    <ul id="messages"></ul>
  </div>
  <div>
    <input id="message" type="text">
    <button onclick="handleSubmitNewMessage()">Submit</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
    <script>
      const socket = io('ws://localhost:4000', {
        transports: ['websocket'],
        auth: {
          token: "Bearer " + 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25vIjoxLCJpYXQiOjE2MzQ3MTMyMTcsImV4cCI6MTYzNDcxNjgxN30.WjHiNTUtiwS-s5I9b8QuFAIDgHaAWUSv_NV8wTqb_xA',
        },
      });

      socket.on('connect', function() {
        console.log('Connected');
      });
      socket.on('events', function(data) {
        console.log('event', data);
      });
      socket.on('exception', function(data) {
        console.log('event', data);
      });
      socket.on('disconnect', function() {
        console.log('Disconnected');
      });

      const message = document.getElementById('message');
      const messages = document.getElementById('messages');

      const handleSubmitNewMessage = () => {
        socket.emit('message', { data: message.value });
      };

      socket.on('message', ({data}) => {
        console.log(data);
        handleNewMessage(data);
      });

      const handleNewMessage = (message) => {
        messages.appendChild(buildNewMessage(message));
      };

      const buildNewMessage = (message) => {
        const li = document.createElement('li');
        li.appendChild(document.createTextNode(message));
        return li;
      };
    </script>
  </div>
</body>
</html>